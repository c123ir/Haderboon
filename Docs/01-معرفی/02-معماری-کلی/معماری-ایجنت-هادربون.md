# معماری کلی ایجنت هادربون

## ۱. معماری کلی سیستم

ایجنت هادربون از معماری سه لایه‌ای تشکیل شده است که شامل لایه‌های زیر می‌باشد:

```
                   ┌───────────────────┐
                   │     کاربران       │
                   └───────────────────┘
                           ▲
                           │
                           ▼
┌─────────────────────────────────────────────────┐
│                 لایه ارائه (فرانت‌اند)            │
│                                                 │
│  React + TypeScript + Tailwind CSS              │
│  کامپوننت‌های رابط کاربری - مدیریت حالت - روتینگ   │
└─────────────────────────────────────────────────┘
                           ▲
                           │
                           ▼
┌─────────────────────────────────────────────────┐
│                 لایه منطق تجاری (بک‌اند)          │
│                                                 │
│  Node.js + Express + TypeScript                 │
│  کنترلرها - سرویس‌ها - میدل‌ویرها - مسیرها        │
└─────────────────────────────────────────────────┘
                           ▲
                           │
                           ▼
┌─────────────────────────────────────────────────┐
│                لایه داده (پایگاه داده)           │
│                                                 │
│  PostgreSQL + Prisma ORM                        │
│  مدل‌ها - میگریشن‌ها - کوئری‌ها                   │
└─────────────────────────────────────────────────┘
                           ▲
                           │
                           ▼
┌─────────────────────────────────────────────────┐
│            سرویس‌های خارجی هوش مصنوعی           │
│                                                 │
│  Google AI Studio (Gemini Pro/Vision)           │
│  OpenRouter, OpenAI API, Claude API             │
└─────────────────────────────────────────────────┘
```

## ۲. تکنولوژی‌ها و ابزارها

### ۲.۱. فرانت‌اند (Frontend)
*   **زبان برنامه‌نویسی:** TypeScript
*   **فریم‌ورک:** React 18.2
*   **استایلینگ:** Tailwind CSS
*   **مدیریت حالت (State Management):** Context API + Custom Hooks
*   **روتینگ:** React Router DOM
*   **ارتباط با سرور:** Axios
*   **فرم‌ها:** React Hook Form
*   **اعتبارسنجی:** Zod / Yup

### ۲.۲. بک‌اند (Backend)
*   **زبان برنامه‌نویسی:** TypeScript
*   **فریم‌ورک:** Node.js + Express.js
*   **ORM:** Prisma
*   **احراز هویت:** JSON Web Tokens (JWT) + bcryptjs
*   **مدیریت درخواست‌ها:** Express Middleware
*   **مدیریت فایل‌ها:** Multer
*   **اعتبارسنجی ورودی‌ها:** express-validator / Zod
*   **لاگینگ:** Winston

### ۲.۳. پایگاه داده (Database)
*   **نوع پایگاه داده:** PostgreSQL
*   **مدیریت دسترسی:** ORM Prisma
*   **میگریشن:** Prisma Migrate
*   **کوئری‌ها:** Prisma Client

### ۲.۴. ارتباط با سرویس‌های هوش مصنوعی
*   **Google AI Studio API (Gemini Pro/Vision):** برای پردازش زبان طبیعی، تحلیل کد، و تحلیل تصاویر
*   **OpenRouter:** برای دسترسی یکپارچه به مدل‌های هوش مصنوعی مختلف
*   **APIهای مستقیم OpenAI و Claude AI:** به عنوان گزینه‌های جایگزین یا مکمل

## ۳. ساختار ماژول‌های اصلی

### ۳.۱. ماژول احراز هویت (Authentication)
*   **ثبت نام کاربر:** ایجاد حساب کاربری با نام کاربری، ایمیل و رمز عبور
*   **ورود کاربر:** اعتبارسنجی کاربر و صدور توکن دسترسی
*   **محافظت از مسیرها:** میدل‌ویر برای حفاظت از مسیرهای دسترسی
*   **مدیریت نشست:** کنترل جلسات کاربری و تمدید توکن‌ها

### ۳.۲. ماژول مدیریت پروژه (Project Management)
*   **ایجاد پروژه:** ثبت پروژه جدید با مشخصات پایه
*   **بارگذاری کد:** آپلود فایل‌ها یا مشخص کردن مسیر دایرکتوری
*   **تحلیل ساختار پروژه:** اسکن و تحلیل ساختار پروژه و وابستگی‌ها
*   **مدیریت پروژه‌ها:** مشاهده، ویرایش و حذف پروژه‌ها

### ۳.۳. ماژول مستندسازی (Documentation)
*   **تولید خودکار مستندات:** ایجاد پیش‌نویس مستندات بر اساس تحلیل کد
*   **سازماندهی مستندات:** دسته‌بندی و مدیریت مستندات پروژه
*   **جستجو در مستندات:** امکان جستجوی متنی در مستندات
*   **بازیابی مستندات:** دسترسی به مستندات قبلی و نسخه‌های مختلف

### ۳.۴. ماژول چت هوشمند (AI Chat)
*   **مکالمه هوشمند:** ارتباط تعاملی با ایجنت هوشمند
*   **ثبت تاریخچه:** نگهداری تاریخچه مکالمات
*   **آپلود فایل/تصویر:** امکان ارسال فایل یا تصویر برای تحلیل
*   **تولید پرامپت:** ایجاد پرامپت‌های حرفه‌ای برای استفاده در ابزارهای AI

### ۳.۵. ماژول یکپارچه‌سازی کد (Code Integration)
*   **اسکن مداوم کد:** تحلیل مستمر تغییرات در کدبیس
*   **همگام‌سازی مستندات:** به‌روزرسانی خودکار مستندات با تغییرات کد
*   **ردیابی تصمیمات طراحی:** ثبت و نگهداری تصمیمات مهم طراحی

## ۴. جریان داده (Data Flow)

### ۴.۱. مسیر احراز هویت
1. کاربر فرم ثبت‌نام یا ورود را تکمیل می‌کند
2. درخواست به سرور بک‌اند ارسال می‌شود
3. سرور اطلاعات را اعتبارسنجی می‌کند
4. در صورت موفقیت، توکن JWT صادر می‌شود
5. توکن در localStorage کلاینت ذخیره می‌شود
6. درخواست‌های بعدی با این توکن ارسال می‌شوند

### ۴.۲. مسیر ایجاد و تحلیل پروژه
1. کاربر اطلاعات پروژه جدید را وارد می‌کند
2. کد پروژه آپلود یا آدرس آن مشخص می‌شود
3. سرور فایل‌ها را اسکن و تحلیل می‌کند
4. اطلاعات ساختاری پروژه استخراج می‌شود
5. پیش‌نویس مستندات با کمک AI تولید می‌شود
6. مستندات در پایگاه داده ذخیره می‌شوند

### ۴.۳. مسیر چت و مشاوره
1. کاربر سوال یا درخواست خود را می‌نویسد
2. درخواست به سرور ارسال می‌شود
3. سرور زمینه پروژه و تاریخچه چت را به همراه درخواست کاربر برای AI ارسال می‌کند
4. پاسخ AI دریافت و به کاربر نمایش داده می‌شود
5. مکالمه در پایگاه داده ذخیره می‌شود

## ۵. امنیت و مقیاس‌پذیری

### ۵.۱. امنیت
*   **احراز هویت:** استفاده از JWT با تاریخ انقضا
*   **رمزنگاری:** هش کردن رمزهای عبور با bcryptjs
*   **محافظت از API:** CORS، Rate Limiting، و Validation
*   **حفاظت از دسترسی:** میدل‌ویرهای احراز هویت برای محافظت از مسیرها
*   **امنیت داده:** اصول OWASP برای محافظت از حملات رایج

### ۵.۲. مقیاس‌پذیری
*   **معماری ماژولار:** تفکیک منطقی کامپوننت‌ها برای توسعه آسان
*   **کش‌کردن (Caching):** کش کردن داده‌های پرکاربرد
*   **تفکیک دغدغه‌ها:** جداسازی لایه‌های مختلف برنامه
*   **افزونگی (Redundancy):** پشتیبانی از چندین نمونه سرور
*   **امکان افزایش افقی (Horizontal Scaling):** طراحی برای افزایش تعداد سرورها 