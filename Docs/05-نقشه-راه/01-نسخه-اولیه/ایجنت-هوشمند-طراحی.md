# طراحی ایجنت هوشمند هادربون

این سند، طراحی ماژول ایجنت هوشمند در پروژه هادربون را توضیح می‌دهد. این ماژول امکان استفاده از قابلیت‌های هوش مصنوعی متنوع را در سیستم فراهم می‌کند.

## معماری کلی

ماژول ایجنت هوشمند از سه بخش اصلی تشکیل شده است:

1. **سیستم مدیریت API های هوش مصنوعی**: امکان تنظیم و ذخیره‌سازی کلیدهای API برای سرویس‌های مختلف هوش مصنوعی
2. **سیستم چت هوشمند**: برقراری ارتباط با API های هوش مصنوعی و دریافت پاسخ
3. **سیستم یکپارچه‌سازی با مستندات**: استفاده از قابلیت‌های هوش مصنوعی برای بهبود فرآیند مستندسازی

## سیستم مدیریت API های هوش مصنوعی

### سرویس‌های پشتیبانی‌شده

در نسخه اولیه، سیستم از API های زیر پشتیبانی می‌کند:

1. **OpenAI** (GPT-3.5, GPT-4 و مدل‌های دیگر)
2. **Google AI Studio** (Gemini Pro و سایر مدل‌ها)
3. **OpenRouter** (با پشتیبانی از انواع مدل‌های متنوع)
4. **Anthropic** (Claude و نسخه‌های مختلف آن)
5. **Grok AI** (xAI)

### مدل داده

مدل داده برای ذخیره‌سازی تنظیمات API شامل موارد زیر است:

```prisma
model AIProvider {
  id          String        @id @default(uuid())
  name        String        // نام سرویس (OpenAI, Google, OpenRouter, ...)
  isActive    Boolean       @default(false)
  priority    Int           @default(0)  // اولویت استفاده در حالت خودکار
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  apiKeys     AIApiKey[]    // کلیدهای API مرتبط با این سرویس
  models      AIModel[]     // مدل‌های این سرویس
  settings    Json?         // تنظیمات خاص سرویس به صورت JSON
  sessions    AISession[]   // جلسات مکالمه با این سرویس
}

model AIApiKey {
  id          String      @id @default(uuid())
  providerId  String      // ارتباط با سرویس
  provider    AIProvider  @relation(fields: [providerId], references: [id], onDelete: Cascade)
  name        String      // نام نمایشی برای کلید
  key         String      // کلید API (رمزنگاری‌شده)
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  expiresAt   DateTime?   // تاریخ انقضای کلید (اختیاری)
}

model AIModel {
  id          String      @id @default(uuid())
  providerId  String      // ارتباط با سرویس
  provider    AIProvider  @relation(fields: [providerId], references: [id], onDelete: Cascade)
  name        String      // نام مدل (gpt-4, claude-2, ...)
  displayName String      // نام نمایشی
  isActive    Boolean     @default(true)
  capabilities String[]   // قابلیت‌های مدل (chat, embedding, ...)
  contextSize Int         // حداکثر اندازه متن ورودی
  settings    Json?       // تنظیمات خاص مدل
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  sessions    AISession[]
}

model AISession {
  id          String      @id @default(uuid())
  title       String      // عنوان جلسه
  providerId  String      // ارتباط با سرویس
  provider    AIProvider  @relation(fields: [providerId], references: [id])
  modelId     String      // ارتباط با مدل
  model       AIModel     @relation(fields: [modelId], references: [id])
  userId      String      // کاربر ایجادکننده
  projectId   String?     // پروژه مرتبط (اختیاری)
  documentId  String?     // مستند مرتبط (اختیاری)
  messages    AIMessage[] // پیام‌های این جلسه
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  settings    Json?       // تنظیمات خاص این جلسه
}

model AIMessage {
  id          String      @id @default(uuid())
  sessionId   String      // ارتباط با جلسه
  session     AISession   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  role        String      // نقش پیام (user, assistant, system)
  content     String      // محتوای پیام
  createdAt   DateTime    @default(now())
}
```

### امنیت و رمزنگاری

- کلیدهای API به صورت رمزنگاری‌شده در دیتابیس ذخیره می‌شوند
- دسترسی به کلیدها فقط برای کاربران با سطح دسترسی مدیر امکان‌پذیر است
- در هنگام استفاده، کلیدها رمزگشایی شده و در حافظه موقت نگهداری می‌شوند

## سیستم چت هوشمند

### قابلیت‌های اصلی

1. **چت تکی**: ارتباط با یک مدل هوش مصنوعی خاص
2. **چت چندگانه**: ارسال یک سؤال به چندین مدل هوش مصنوعی به طور همزمان
3. **جمع‌بندی نتایج**: امکان جمع‌بندی پاسخ‌های چندین مدل توسط یک مدل منتخب
4. **ذخیره‌سازی تاریخچه**: نگهداری تاریخچه مکالمات برای استفاده بعدی

### معماری فنی

برای پیاده‌سازی سیستم چت هوشمند، از الگوی Adapter استفاده می‌کنیم:

1. یک واسط (Interface) یکسان برای تمام سرویس‌های هوش مصنوعی
2. پیاده‌سازی‌های خاص برای هر سرویس (OpenAI Adapter, Google AI Adapter, ...)
3. یک کلاس Factory برای ایجاد Adapter مناسب بر اساس نوع سرویس
4. یک سرویس هماهنگ‌کننده (Orchestrator) برای مدیریت درخواست‌های چندگانه

## سیستم یکپارچه‌سازی با مستندات

### قابلیت‌های پیشنهادی

1. **تولید خودکار مستندات**: تولید مستندات اولیه بر اساس کد یا توضیحات پروژه
2. **بهبود کیفیت مستندات**: پیشنهاد بهبود متن مستندات موجود
3. **پاسخ به سؤالات**: امکان پرسش سؤال درباره پروژه و دریافت پاسخ بر اساس مستندات
4. **خلاصه‌سازی**: ایجاد خلاصه از مستندات طولانی
5. **ترجمه**: ترجمه مستندات به زبان‌های مختلف

## برنامه پیاده‌سازی

### مرحله ۱: زیرساخت مدیریت API

1. پیاده‌سازی مدل‌های داده در Prisma
2. پیاده‌سازی API‌های بک‌اند برای مدیریت کلیدها و تنظیمات
3. پیاده‌سازی رابط کاربری تنظیمات در فرانت‌اند

### مرحله ۲: پیاده‌سازی سیستم چت هوشمند

1. پیاده‌سازی Adapter‌ها برای سرویس‌های مختلف
2. پیاده‌سازی سرویس هماهنگ‌کننده چت چندگانه
3. پیاده‌سازی رابط کاربری چت در فرانت‌اند

### مرحله ۳: یکپارچه‌سازی با سیستم مستندات

1. پیاده‌سازی قابلیت‌های کمکی در ویرایشگر مستندات
2. پیاده‌سازی سیستم تولید خودکار مستندات
3. یکپارچه‌سازی با بخش مستندات موجود

## نتیجه‌گیری

ماژول ایجنت هوشمند با قابلیت استفاده از چندین سرویس هوش مصنوعی، امکانات گسترده‌ای را در اختیار کاربران قرار می‌دهد. این قابلیت منحصربه‌فرد می‌تواند مزیت رقابتی مهمی برای پروژه هادربون ایجاد کند. 